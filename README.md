# Diffusion Transformer Meets Random Masks: An Advanced PET Reconstruction Framework

Author: Bin Huang, Feihong Xu, Xinchong Shi, Shan Huang, Binxuan Li, Fei Li, Qiegen Liu

In clinical practice, single-radiotracer positron emission tomography (PET) is commonly used for imaging. Although multi-tracer PET imaging can provide supplementary information of radiotracers that are sensitive to physiological function changes, enabling a more comprehensive characterization of physiological and pathological states, the gamma-photon pairs generated by positron annihilation reactions of different tracers in PET imaging have the same energy, making it difficult to distinguish the tracer signals. In this study, a multi-latent space guided texture conditional diffusion transformer model (MS-CDT) is proposed for PET tracer separation. To the best of our knowledge, this is the first attempt to use texture condition and multi-latent space for tracer separation in PET imaging. The proposed model integrates diffusion and transformer architectures into a unified optimization framework, with the novel addition of texture masks as conditional inputs to enhance image details. By leveraging multi-latent space prior derived from different tracers, the model captures multi-level feature representations, aiming to balance computational efficiency and detail preservation. The texture masks, serving as conditional guidance, help the model focus on salient structural patterns, thereby improving the extraction and utilization of fine-grained image textures. When combined with the diffusion transformer backbone, this conditioning mechanism contributes to more accurate and robust tracer separation. To evaluate its effectiveness, the proposed MS-CDT is compared with several advanced methods on two types of 3D PET datasets: brain and chest scans. Experimental results indicate that MS-CDT achieved competitive performance in terms of image quality and preservation of clinically relevant information. 

## MS-CDT network architecture
![](https://github.com/yqx7150/MS-CDT/blob/main/MS-CDT_data/figs/MS-CDT%20network%20architecture.png)
Pipeline of the MS-CDT network architecture. MS-CDT is mainly composed of a TMCB, an LPEB, a diffusion stage, and a transformer stage. The tracer PET obtains texture features through the TMCB. The dual-tracer PET and the two single-tracer PETs are respectively combined into an MSP. The texture conditions and the MSP enter the diffusion stage, the texture conditions and the MSP guide the transformer stage to utilize the predicted priors for separation.

## MSP Extraction Block architecture
![](https://github.com/yqx7150/MS-CDT/blob/main/MS-CDT_data/figs/MSP%20Extraction%20Block%20architecture.png)
The pipeline of MSP Extraction Block architecture. Conv: Convolutional layer, LRelu: Leaky Rectified Linear Unit, Avg pool: Average Pooling.
## Results of separating and reconstructing the coronal images of dual tracers of patient I
![](https://github.com/yqx7150/MS-CDT/blob/main/MS-CDT_data/figs/Results%20of%20separating%20and%20reconstructing%20the%20coronal%20images%20of%20dual%20tracers%20of%20patient%20I.png)
Results of separating and reconstructing the coronal images of dual tracers of patient I, namely  and  tracers, using different methods are presented. Comparisons are made among (a) the dual tracers, (b) the original PET of the tracers, (c) iVAN, (d) the DL-based method, (e) MPRnet, (f) pix2pix, (g) DTM, and (h) the images separated by MS-CDT. The detailed magnified images are described in the upper right corner of the first row. The second row shows the residuals between the reference images and the reconstructed images.

## Results of separating and reconstructing the coronal images of dual tracers of patient II
![](https://github.com/yqx7150/MS-CDT/blob/main/MS-CDT_data/figs/Results%20of%20separating%20and%20reconstructing%20the%20coronal%20images%20of%20dual%20tracers%20of%20patient%20II.png)
Results of separating and reconstructing the coronal images of dual tracers of patient II, namely  and  tracers, using different methods are presented. Comparisons are made among (a) the dual tracers, (b) the original PET of the tracers, (c) iVAN, (d) the DL-based method, (e) MPRnet, (f) pix2pix, (g) DTM, and (h) the images separated by MS-CDT. The detailed magnified images are described in the upper right corner of the first row. The second row shows the residuals between the reference images and the reconstructed images.

## Results of separating and reconstructing the transverse images of dual tracers of patient I
![](https://github.com/yqx7150/MS-CDT/blob/main/MS-CDT_data/figs/Results%20of%20separating%20and%20reconstructing%20the%20transverse%20images%20of%20dual%20tracers%20of%20patient%20I.png)
Results of separating and reconstructing the transverse images of dual tracers of patient I, namely  and  tracers, using different methods are presented. Comparisons are made among (a) the dual tracers, (b) the original PET of the tracers, (c) iVAN, (d) the DL-based method, (e) MPRnet, (f) pix2pix, (g) DTM, and (h) the images separated by MS-CDT. The detailed magnified images are described in the upper right transverse of the first row. The second row shows the residuals between the reference images and the reconstructed images.

## Results of separating and reconstructing the transverse images of dual tracers of patient II
![](https://github.com/yqx7150/MS-CDT/blob/main/MS-CDT_data/figs/Results%20of%20separating%20and%20reconstructing%20the%20transverse%20images%20of%20dual%20tracers%20of%20patient%20II.png)
Results of separating and reconstructing the transverse images of dual tracers of patient II, namely  and  tracers, using different methods are presented. Comparisons are made among (a) the dual tracers, (b) the original PET of the tracers, (c) iVAN, (d) the DL-based method, (e) MPRnet, (f) pix2pix, (g) DTM, and (h) the images separated by MS-CDT. The detailed magnified images are described in the upper right transverse of the first row. The second row shows the residuals between the reference images and the reconstructed images.

## Other Related Projects
* ALL-PET: A Low-resource and Low-shot PET Foundation Model in Projection Domain  [<font size=5>**[Paper]**</font>](https://github.com/yqx7150/RAYSOLUTION_PETdata/blob/main/Paper/ALL_PET_Finalx.pdf)   [<font size=5>**[Code]**</font>](https://github.com/yqx7150/ALL-PET)

* Diffusion Transformer Model with Compact Prior for Low-dose PET Reconstruction [<font size=5>**[Paper]**</font>](https://arxiv.org/abs/2407.00944)     [<font size=5>**[Code]**</font>](https://github.com/yqx7150/dtm)

* RED: Residual Estimation Diffusion for Low-Dose PET Sinogram Reconstruction  [<font size=5>**[Paper]**</font>](https://www.sciencedirect.com/science/article/pii/S1361841525001057)       [<font size=5>**[Code]**</font>](https://github.com/yqx7150/RED)  

* Synthetic CT Generation via Variant Invertible Network for Brain PET Attenuation Correction [<font size=5>**[Paper]**</font>](https://ieeexplore.ieee.org/document/10666843) [<font size=5>**[Code]**</font>](https://github.com/yqx7150/PET_AC_sCT)

* Raysolution_PET_Data [<font size=5>**[Data]**</font>](https://github.com/yqx7150/Raysolution_PET_Data)   
* Spatial-Temporal Guided Diffusion Transformer Probabilistic Model for Delayed Scan PET Image Prediction [<font size=5>**[Paper]**</font>](https://ieeexplore.ieee.org/abstract/document/10980366)   [<font size=5>**[Code]**</font>](https://github.com/yqx7150/st-DTPM)    

* Double-Constraint Diffusion Model with Nuclear Regularization for Ultra-low-dose PET Reconstruction  [<font size=5>**[Paper]**</font>](https://arxiv.org/pdf/2509.00395)   [<font size=5>**[Code]**</font>](https://github.com/yqx7150/DCDM)
